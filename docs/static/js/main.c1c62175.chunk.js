(this["webpackJsonp@test-task-avito/react"]=this["webpackJsonp@test-task-avito/react"]||[]).push([[0],{102:function(e,t,n){e.exports={button:"NavbarComponent_button__1NXhp",icon:"NavbarComponent_icon__2QjTR"}},119:function(e,t){},125:function(e,t){},133:function(e,t,n){e.exports={rotating:"RefreshButton_rotating__28Fr1"}},145:function(e,t,n){},181:function(e,t){},190:function(e,t,n){"use strict";n.r(t);var r,c=n(0),a=n.n(c),o=n(19),i=n.n(o),s=n(14),u=n(32),l=n(11),d=n(8),j=n(3),b=n(33),m=n.n(b),O=n(2),f=n(59),h=n(131),x=n(20),v=Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_DEPLOY_URL_PREFIX:"test-task-avito"}),p=v.REACT_APP_HACKER_NEWS_API_URL,g=v.REACT_APP_POLLING_INTERVAL,_=v.REACT_APP_STORIES_QTY,N=v.REACT_APP_STORIES_QTY_PER_PAGE,y=v.REACT_APP_DEPLOY_URL_PREFIX,S=p||"https://hacker-news.firebaseio.com/v0/",k=Number(g)||6e4,w=Number(_)||100,C=Number(N)||10,P=y||"",E=function(e){return 1e3*e},T=function(e){return new Date(e).toLocaleString("en",{year:"numeric",month:"long",day:"numeric"})},R=Object(h.a)({reducerPath:"storyApi",baseQuery:Object(x.d)({baseUrl:S}),endpoints:function(e){return{getNewStories:e.query({queryFn:function(e,t,n,r){return Object(f.a)(m.a.mark((function e(){var t,n,c,a,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r("newstories.json");case 2:if(!(t=e.sent).error){e.next=5;break}return e.abrupt("return",{error:t.error});case 5:return n=t.data,c=n.slice(0,w).map((function(e){return r("item/".concat(e,".json"))})),e.next=9,Promise.all(c);case 9:return a=e.sent,o=a.find((function(e){return e.error})),e.abrupt("return",o?{error:o}:{data:a.filter((function(e){var t=e.data;return Boolean(t)})).map((function(e){var t=e.data;return Object(O.a)(Object(O.a)({},t),{},{time:E((null===t||void 0===t?void 0:t.time)||0)})}))});case 12:case"end":return e.stop()}}),e)})))()}})}}}),A=R.useGetNewStoriesQuery,I=n(22),F=n(23),L=function(e){var t=e.map((function(e){return fetch("".concat(S,"item/").concat(e,".json"),{method:"GET"}).then((function(e){if(e.ok)return e.json();throw new Error("Error with status code ".concat(e.status))})).then((function(e){return Object(O.a)(Object(O.a)({},e),{},{time:E(e.time)})}))}));return Promise.all(t)};!function(e){e.Idle="idle",e.Pending="pending",e.Fulfilled="fulfilled",e.Rejected="rejected"}(r||(r={}));var D,B=Object(j.c)("comments/fetchAll",function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){var e=Object(f.a)(m.a.mark((function e(t,r){var c,a,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==r.length){e.next=2;break}return e.abrupt("return",t);case 2:return c=[],e.prev=3,e.next=6,L(r);case 6:c=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("Log somewhere error",e.t0);case 12:return a=c.filter((function(e){return e&&!e.deleted})),o=a.reduce((function(e,t){var n=t.kids,r=void 0===n?[]:n;return r.length>0?[].concat(Object(I.a)(e),Object(I.a)(r)):e}),[]),e.abrupt("return",n([].concat(Object(I.a)(t),Object(I.a)(a)),o));case 15:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t,n){return e.apply(this,arguments)}}(),e.abrupt("return",n([],t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),H=Object(j.d)(),M=H.getInitialState({loading:r.Idle}),q=Object(j.e)({name:"comments",initialState:M,reducers:{},extraReducers:function(e){e.addCase(B.pending,(function(e){e.loading===r.Idle&&(e.loading=r.Pending)})),e.addCase(B.fulfilled,(function(e,t){e.loading===r.Pending&&(H.upsertMany(e,t.payload),e.loading=r.Idle)}))}}).reducer,Q=H.getSelectors((function(e){return e.comments})),U=(Q.selectById,Q.selectIds,Q.selectEntities),W=Q.selectAll,G=(Q.selectTotal,Object(F.a)(U,(function(e,t){return t}),(function(e,t){var n=t.reduce((function(t,n){return e[n]?Object(O.a)(Object(O.a)({},t),{},Object(d.a)({},n,e[n])):t}),{});return{ids:t,entities:n}})),Object(F.a)(U,(function(e,t){return t}),(function(e,t){var n=function(t){var n;return e[t]&&!(null===(n=e[t])||void 0===n?void 0:n.deleted)},r=t.filter(n),c=function t(r,c){if(0===c.length)return r;var a=c.reduce((function(t,r){var c,a,o=(null===(c=e[r])||void 0===c||null===(a=c.kids)||void 0===a?void 0:a.filter(n))||[];return o.length>0?[].concat(Object(I.a)(t),Object(I.a)(o)):t}),[]);return a.length+t(r,a)}(r.length,r);return c}))),K=function(e){return e.comments.loading===r.Pending},Y="numberOfDisplayedStories",J=Object(j.e)({name:Y,initialState:{qty:C},reducers:{increaseNumberOfDisplayedStories:function(e){e.qty+=C}}}),X=J.actions.increaseNumberOfDisplayedStories,z=J.reducer,V=function(e){return e.numberOfDisplayedStories.qty},$=Object(j.a)({reducer:(D={},Object(d.a)(D,R.reducerPath,R.reducer),Object(d.a)(D,"comments",q),Object(d.a)(D,Y,z),D),middleware:function(e){return e().concat(R.middleware)}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(145);var Z=n(195),ee=n(198),te=n(202),ne=n(197),re=n(4),ce=n.n(re),ae=n(99),oe=n.n(ae),ie=function(){return Object(s.d)()},se=s.e,ue=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(c.useEffect)((function(){document.title="function"===typeof e?e():e}),t)},le=n(200),de=n(1),je=function(e){var t=e.children,n=e.navbarComponent;return Object(de.jsxs)(de.Fragment,{children:[Object(de.jsx)(le.a,{bg:"light",expand:"lg",children:Object(de.jsxs)(Z.a,{children:[Object(de.jsx)(le.a.Brand,{children:Object(de.jsx)(u.b,{to:"/",className:"fs-2 ms-3 text-muted text-decoration-none",children:"Avito test task"})}),n&&Object(de.jsx)(n,{})]})}),t]})},be=function(){return Object(de.jsx)("span",{className:"ms-2 me-2",children:"|"})},me=n(196),Oe=n(199),fe=n(77),he=n(133),xe=n.n(he),ve={width:25,height:25},pe=function(e){var t=e.tooltipText,n=void 0===t?"Refresh":t,r=e.tooltipPlacement,c=void 0===r?"top":r,a=e.onClick,o=e.disabled;return Object(de.jsx)(Oe.a,{placement:c,overlay:function(e){return Object(de.jsx)(me.a,Object(O.a)(Object(O.a)({id:"button-tooltip"},e),{},{children:n}))},children:Object(de.jsx)(ne.a,{className:"ms-5",onClick:a,disabled:o,children:Object(de.jsx)(fe.a,{style:ve,className:ce()(Object(d.a)({},xe.a.rotating,o))})})})},ge=function(e){var t=e.onClick,n=e.isFetching;return Object(de.jsx)("div",{className:"me-3",children:Object(de.jsx)(pe,{tooltipText:"Refresh News",tooltipPlacement:"left",onClick:t,disabled:n})})};var _e=function(){ue("Hottest stories");var e=Object(s.e)(V),t=A(void 0,{pollingInterval:k}),n=t.data,r=void 0===n?[]:n,o=t.refetch,i=t.isFetching,l=t.isLoading,j=a.a.useMemo((function(){return r.slice(0,e)}),[e,r]),b=ie(),m=Object(c.useCallback)((function(){return b(X())}),[b]);return Object(de.jsx)(je,{navbarComponent:function(){return Object(de.jsx)(ge,{onClick:o,isFetching:i})},children:Object(de.jsx)(Z.a,{className:ce()(oe.a.content,Object(d.a)({},oe.a["content--loading"],l)),children:l?Object(de.jsx)(ee.a,{animation:"border",variant:"primary"}):Object(de.jsxs)(de.Fragment,{children:[j.map((function(e){return Object(de.jsx)(u.b,{to:"/".concat(e.id),className:"text-start text-decoration-none d-block mb-2",children:Object(de.jsx)(te.a,{bg:"light",children:Object(de.jsxs)(te.a.Body,{children:[Object(de.jsx)(te.a.Title,{children:e.title}),Object(de.jsxs)(te.a.Subtitle,{children:["".concat(e.score," points"),Object(de.jsx)(be,{}),e.by,Object(de.jsx)(be,{}),T(e.time),e.kids&&Object(de.jsxs)(de.Fragment,{children:[Object(de.jsx)(be,{}),Object(de.jsx)("span",{children:"Comments"})]})]})]})})},e.id)})),0!==j.length&&e<w&&Object(de.jsx)(ne.a,{variant:"outline-primary",onClick:m,className:"mt-3",children:"Show more"})]})})})},Ne=n(9),ye=n(101),Se=n(201),ke=n(76),we=n.n(ke),Ce=n(75),Pe=n.n(Ce),Ee=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return n?n.map((function(n){var r=e.find((function(e){return e.id===n}));return r&&Object(de.jsx)(Te,{comment:r,expand:t,comments:e})})):null};function Te(e){var t=e.comments,n=e.comment,r=e.onClick,c=e.rootCommentsState,a=e.expand,o=c&&t.some((function(e){return e.parent===n.id})),i=a||o&&(null===c||void 0===c?void 0:c[n.id]);return Object(de.jsx)(te.a,{bg:"light",className:ce()("mb-3",{"ms-4 mt-3":!c}),children:Object(de.jsxs)(te.a.Body,{children:[Object(de.jsxs)(te.a.Subtitle,{className:"text-muted ".concat(Pe.a.comment__header),children:[n.by,Object(de.jsx)(be,{}),T(n.time),o&&Object(de.jsxs)(de.Fragment,{children:[Object(de.jsx)(be,{}),Object(de.jsxs)(ne.a,{variant:"link",className:"text-decoration-none",size:"sm",onClick:r,children:["[",i?"hide answers":"show answers","]"]})]})]}),Object(de.jsx)(te.a.Text,{className:"mt-2",dangerouslySetInnerHTML:{__html:we()(n.text)}}),i&&Ee(t,i,null===n||void 0===n?void 0:n.kids)]})})}var Re=n(102),Ae=n.n(Re),Ie=function(){return Object(de.jsx)(u.b,{to:"/",className:"fs-2 ms-3 justify-content-end",children:Object(de.jsxs)(ne.a,{className:Ae.a.button,variant:"light",children:[Object(de.jsx)(fe.b,{className:Ae.a.icon}),"Back to the News List"]})})},Fe=function(e){var t=e.children;return Object(de.jsx)(je,{navbarComponent:Ie,children:Object(de.jsx)("div",{className:"container pt-2",children:t})})};var Le=function(){var e=Object(l.g)().id,t=Number(e);ue((function(){return"title ".concat(t)}),[t]);var n=A(void 0,{selectFromResult:function(e){var n=e.data;return{story:null===n||void 0===n?void 0:n.find((function(e){return e.id===t}))}}}).story,r=Object(c.useState)(n),o=Object(Ne.a)(r,2),i=o[0],s=o[1],u=Object(c.useState)(null),j=Object(Ne.a)(u,2),b=j[0],m=j[1],f=Object(c.useMemo)((function(){return(null===i||void 0===i?void 0:i.kids)||[]}),[i]),h=f.reduce((function(e,t){return Object(O.a)(Object(O.a)({},e),{},Object(d.a)({},t,!1))}),{}),x=Object(c.useState)(h),v=Object(Ne.a)(x,2),p=v[0],g=v[1],_=Object(c.useCallback)(Object(ye.memoize)((function(e){return function(){return g((function(t){return Object(O.a)(Object(O.a)({},t),{},Object(d.a)({},e,!t[e]))}))}})),[]),N=ie(),y=Object(c.useCallback)((function(){return N(B(f))}),[N,f]);a.a.useEffect((function(){if(i){var e;return function t(){y(),e=setTimeout((function(){t()}),k)}(),function(){return clearTimeout(e)}}L([t]).then((function(e){var t=Object(Ne.a)(e,1)[0];return s(t)})).catch((function(e){m(e.message),console.error("Log somewhere error",e)}))}),[y,i,t]);var S=se(W),w=a.a.useMemo((function(){return S.filter((function(e){return e.parent===Number(t)}))}),[t,S]),C=se((function(e){return G(e,f)})),P=se(K);return i?Object(de.jsxs)(Fe,{children:[Object(de.jsx)("h1",{className:"mt-4 mb-4",children:i.title}),Object(de.jsxs)("dl",{className:"row",children:[Object(de.jsx)("dt",{className:"col-sm-1",children:"Author"}),Object(de.jsx)("dd",{className:"col-sm-11",children:i.by}),Object(de.jsx)("dt",{className:"col-sm-1",children:"Date"}),Object(de.jsx)("dd",{className:"col-sm-11",children:T(i.time)}),i.url&&Object(de.jsxs)(de.Fragment,{children:[Object(de.jsx)("dt",{className:"col-sm-1",children:"link"}),Object(de.jsx)("dd",{className:"col-sm-11",children:Object(de.jsx)("a",{href:i.url,children:i.url})})]}),i.text&&Object(de.jsxs)(de.Fragment,{children:[Object(de.jsx)("dt",{className:"col-sm-1",children:"Text"}),Object(de.jsx)("dd",{className:"col-sm-11",dangerouslySetInnerHTML:{__html:we()(i.text)}})]})]}),Object(ye.isEmpty)(w)?null:Object(de.jsxs)(de.Fragment,{children:[Object(de.jsxs)("div",{className:"d-flex align-items-center mt-5 mb-4",children:[Object(de.jsxs)("h2",{children:["Comments (",C,")"]}),Object(de.jsx)(pe,{onClick:y,disabled:P,tooltipText:"Refresh comments"})]}),w.map((function(e){return Object(de.jsx)(Te,{comment:e,onClick:_(e.id),rootCommentsState:p,comments:S},e.id)}))]})]}):Object(de.jsx)(Fe,{children:Object(de.jsx)("div",{className:Pe.a["story--loading"],children:b?Object(de.jsxs)(Se.a,{variant:"danger",children:["Something goes wrong: \xa0".concat(b),Object(de.jsx)("br",{}),Object(de.jsx)("br",{}),"Try to refresh the page."]}):Object(de.jsx)(ee.a,{animation:"border",variant:"primary"})})})};i.a.render(Object(de.jsx)(a.a.StrictMode,{children:Object(de.jsx)(s.a,{store:$,children:Object(de.jsx)(u.a,{basename:"/".concat(P),children:Object(de.jsxs)(l.d,{children:[Object(de.jsx)(l.b,{path:"/",component:_e,exact:!0}),Object(de.jsx)(l.b,{path:"/:id",component:Le,exact:!0}),Object(de.jsx)(l.a,{to:"/"})]})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},75:function(e,t,n){e.exports={"comments--loading":"Story_comments--loading__1vnw4","story--loading":"Story_story--loading__v6jwJ"}},89:function(e,t){},90:function(e,t){},99:function(e,t,n){e.exports={content:"Home_content__2Q55q","content--loading":"Home_content--loading__1nnvB"}}},[[190,1,2]]]);
//# sourceMappingURL=main.c1c62175.chunk.js.map