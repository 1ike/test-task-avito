(this["webpackJsonp@test-task-avito/react"]=this["webpackJsonp@test-task-avito/react"]||[]).push([[0],{116:function(e,t){},122:function(e,t){},131:function(e,t,n){e.exports={rotating:"RefreshButton_rotating__28Fr1"}},143:function(e,t,n){},185:function(e,t){},190:function(e,t,n){"use strict";n.r(t);var r,c=n(0),a=n.n(c),i=n(19),o=n.n(i),s=n(14),u=n(32),l=n(11),d=n(8),j=n(3),b=n(33),m=n.n(b),O=n(2),f=n(59),h=n(129),x=n(20),v=Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_DEPLOY_URL_PREFIX:"test-task-avito"}),p=v.REACT_APP_HACKER_NEWS_API_URL,g=v.REACT_APP_POLLING_INTERVAL,_=v.REACT_APP_STORIES_QTY,N=v.REACT_APP_STORIES_QTY_PER_PAGE,y=v.REACT_APP_DEPLOY_URL_PREFIX,S=p||"https://hacker-news.firebaseio.com/v0/",k=Number(g)||6e4,w=Number(_)||100,C=Number(N)||10,P=y?"/".concat(y):"",E=function(e){return P+e},T=function(e){return 1e3*e},R=function(e){return new Date(e).toLocaleString("en",{year:"numeric",month:"long",day:"numeric"})},A=Object(h.a)({reducerPath:"storyApi",baseQuery:Object(x.d)({baseUrl:S}),endpoints:function(e){return{getNewStories:e.query({queryFn:function(e,t,n,r){return Object(f.a)(m.a.mark((function e(){var t,n,c,a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r("newstories.json");case 2:if(!(t=e.sent).error){e.next=5;break}return e.abrupt("return",{error:t.error});case 5:return n=t.data,c=n.slice(0,w).map((function(e){return r("item/".concat(e,".json"))})),e.next=9,Promise.all(c);case 9:return a=e.sent,i=a.find((function(e){return e.error})),e.abrupt("return",i?{error:i}:{data:a.filter((function(e){var t=e.data;return Boolean(t)})).map((function(e){var t=e.data;return Object(O.a)(Object(O.a)({},t),{},{time:T((null===t||void 0===t?void 0:t.time)||0)})}))});case 12:case"end":return e.stop()}}),e)})))()}})}}}),I=A.useGetNewStoriesQuery,F=n(23),L=n(22),D=function(e){var t=e.map((function(e){return fetch("".concat(S,"item/").concat(e,".json"),{method:"GET"}).then((function(e){if(e.ok)return e.json();throw new Error("Error with status code ".concat(e.status))})).then((function(e){return Object(O.a)(Object(O.a)({},e),{},{time:T(e.time)})}))}));return Promise.all(t)};!function(e){e.Idle="idle",e.Pending="pending",e.Fulfilled="fulfilled",e.Rejected="rejected"}(r||(r={}));var B,H=Object(j.c)("comments/fetchAll",function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){var e=Object(f.a)(m.a.mark((function e(t,r){var c,a,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==r.length){e.next=2;break}return e.abrupt("return",t);case 2:return c=[],e.prev=3,e.next=6,D(r);case 6:c=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("Log somewhere error",e.t0);case 12:return a=c.filter((function(e){return e&&!e.deleted})),i=a.reduce((function(e,t){var n=t.kids,r=void 0===n?[]:n;return r.length>0?[].concat(Object(F.a)(e),Object(F.a)(r)):e}),[]),e.abrupt("return",n([].concat(Object(F.a)(t),Object(F.a)(a)),i));case 15:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t,n){return e.apply(this,arguments)}}(),e.abrupt("return",n([],t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),M=Object(j.d)(),q=M.getInitialState({loading:r.Idle}),Q=Object(j.e)({name:"comments",initialState:q,reducers:{},extraReducers:function(e){e.addCase(H.pending,(function(e){e.loading===r.Idle&&(e.loading=r.Pending)})),e.addCase(H.fulfilled,(function(e,t){e.loading===r.Pending&&(M.upsertMany(e,t.payload),e.loading=r.Idle)}))}}).reducer,U=M.getSelectors((function(e){return e.comments})),W=(U.selectById,U.selectIds,U.selectEntities),G=U.selectAll,K=(U.selectTotal,Object(L.a)(W,(function(e,t){return t}),(function(e,t){var n=t.reduce((function(t,n){return e[n]?Object(O.a)(Object(O.a)({},t),{},Object(d.a)({},n,e[n])):t}),{});return{ids:t,entities:n}})),Object(L.a)(W,(function(e,t){return t}),(function(e,t){var n=function(t){var n;return e[t]&&!(null===(n=e[t])||void 0===n?void 0:n.deleted)},r=t.filter(n),c=function t(r,c){if(0===c.length)return r;var a=c.reduce((function(t,r){var c,a,i=(null===(c=e[r])||void 0===c||null===(a=c.kids)||void 0===a?void 0:a.filter(n))||[];return i.length>0?[].concat(Object(F.a)(t),Object(F.a)(i)):t}),[]);return a.length+t(r,a)}(r.length,r);return c}))),Y=function(e){return e.comments.loading===r.Pending},J="numberOfDisplayedStories",X=Object(j.e)({name:J,initialState:{qty:C},reducers:{increaseNumberOfDisplayedStories:function(e){e.qty+=C}}}),z=X.actions.increaseNumberOfDisplayedStories,V=X.reducer,$=function(e){return e.numberOfDisplayedStories.qty},Z=Object(j.a)({reducer:(B={},Object(d.a)(B,A.reducerPath,A.reducer),Object(d.a)(B,"comments",Q),Object(d.a)(B,J,V),B),middleware:function(e){return e().concat(A.middleware)}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(143);var ee=n(195),te=n(198),ne=n(202),re=n(197),ce=n(4),ae=n.n(ce),ie=n(96),oe=n.n(ie),se=function(){return Object(s.d)()},ue=s.e,le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(c.useEffect)((function(){document.title="function"===typeof e?e():e}),t)},de=n(200),je=n(1),be=function(e){var t=e.children,n=e.navbarComponent;return Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)(de.a,{bg:"light",expand:"lg",children:Object(je.jsxs)(ee.a,{children:[Object(je.jsx)(de.a.Brand,{children:Object(je.jsx)(u.b,{to:E("/"),className:"fs-2 ms-3 text-muted text-decoration-none",children:"Avito test task"})}),n&&Object(je.jsx)(n,{})]})}),t]})},me=function(){return Object(je.jsx)("span",{className:"ms-2 me-2",children:"|"})},Oe=n(196),fe=n(199),he=n(75),xe=n(131),ve=n.n(xe),pe={width:25,height:25},ge=function(e){var t=e.tooltipText,n=void 0===t?"Refresh":t,r=e.tooltipPlacement,c=void 0===r?"top":r,a=e.onClick,i=e.disabled;return Object(je.jsx)(fe.a,{placement:c,overlay:function(e){return Object(je.jsx)(Oe.a,Object(O.a)(Object(O.a)({id:"button-tooltip"},e),{},{children:n}))},children:Object(je.jsx)(re.a,{className:"ms-5",onClick:a,disabled:i,children:Object(je.jsx)(he.a,{style:pe,className:ae()(Object(d.a)({},ve.a.rotating,i))})})})},_e=function(e){var t=e.onClick,n=e.isFetching;return Object(je.jsx)("div",{className:"me-3",children:Object(je.jsx)(ge,{tooltipText:"Refresh News",tooltipPlacement:"left",onClick:t,disabled:n})})};var Ne=function(){le("Hottest stories");var e=Object(s.e)($),t=I(void 0,{pollingInterval:k}),n=t.data,r=void 0===n?[]:n,i=t.refetch,o=t.isFetching,l=t.isLoading,j=a.a.useMemo((function(){return r.slice(0,e)}),[e,r]),b=se(),m=Object(c.useCallback)((function(){return b(z())}),[b]);return Object(je.jsx)(be,{navbarComponent:function(){return Object(je.jsx)(_e,{onClick:i,isFetching:o})},children:Object(je.jsx)(ee.a,{className:ae()(oe.a.content,Object(d.a)({},oe.a["content--loading"],l)),children:l?Object(je.jsx)(te.a,{animation:"border",variant:"primary"}):Object(je.jsxs)(je.Fragment,{children:[j.map((function(e){return Object(je.jsx)(u.b,{to:E("/".concat(e.id)),className:"text-start text-decoration-none d-block mb-2",children:Object(je.jsx)(ne.a,{bg:"light",children:Object(je.jsxs)(ne.a.Body,{children:[Object(je.jsx)(ne.a.Title,{children:e.title}),Object(je.jsxs)(ne.a.Subtitle,{children:["".concat(e.score," points"),Object(je.jsx)(me,{}),e.by,Object(je.jsx)(me,{}),R(e.time),e.kids&&Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)(me,{}),Object(je.jsx)("span",{children:"Comments"})]})]})]})})},e.id)})),0!==j.length&&e<w&&Object(je.jsx)(re.a,{variant:"outline-primary",onClick:m,className:"mt-3",children:"Show more"})]})})})},ye=n(9),Se=n(98),ke=n(201),we=n(74),Ce=n.n(we),Pe=n(73),Ee=n.n(Pe),Te=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return n?n.map((function(n){var r=e.find((function(e){return e.id===n}));return r&&Object(je.jsx)(Re,{comment:r,expand:t,comments:e})})):null};function Re(e){var t=e.comments,n=e.comment,r=e.onClick,c=e.rootCommentsState,a=e.expand,i=c&&t.some((function(e){return e.parent===n.id})),o=a||i&&(null===c||void 0===c?void 0:c[n.id]);return Object(je.jsx)(ne.a,{bg:"light",className:ae()("mb-3",{"ms-4 mt-3":!c}),children:Object(je.jsxs)(ne.a.Body,{children:[Object(je.jsxs)(ne.a.Subtitle,{className:"text-muted ".concat(Ee.a.comment__header),children:[n.by,Object(je.jsx)(me,{}),R(n.time),i&&Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)(me,{}),Object(je.jsxs)(re.a,{variant:"link",className:"text-decoration-none",size:"sm",onClick:r,children:["[",o?"hide answers":"show answers","]"]})]})]}),Object(je.jsx)(ne.a.Text,{className:"mt-2",dangerouslySetInnerHTML:{__html:Ce()(n.text)}}),o&&Te(t,o,null===n||void 0===n?void 0:n.kids)]})})}var Ae=n(99),Ie=n.n(Ae),Fe=function(){return Object(je.jsx)(u.b,{to:E("/"),className:"fs-2 ms-3 justify-content-end",children:Object(je.jsxs)(re.a,{className:Ie.a.button,variant:"light",children:[Object(je.jsx)(he.b,{className:Ie.a.icon}),"Back to the News List"]})})},Le=function(e){var t=e.children;return Object(je.jsx)(be,{navbarComponent:Fe,children:Object(je.jsx)("div",{className:"container pt-2",children:t})})};var De=function(){var e=Object(l.f)().id,t=Number(e);le((function(){return"title ".concat(t)}),[t]);var n=I(void 0,{selectFromResult:function(e){var n=e.data;return{story:null===n||void 0===n?void 0:n.find((function(e){return e.id===t}))}}}).story,r=Object(c.useState)(n),i=Object(ye.a)(r,2),o=i[0],s=i[1],u=Object(c.useState)(null),j=Object(ye.a)(u,2),b=j[0],m=j[1],f=Object(c.useMemo)((function(){return(null===o||void 0===o?void 0:o.kids)||[]}),[o]),h=f.reduce((function(e,t){return Object(O.a)(Object(O.a)({},e),{},Object(d.a)({},t,!1))}),{}),x=Object(c.useState)(h),v=Object(ye.a)(x,2),p=v[0],g=v[1],_=Object(c.useCallback)(Object(Se.memoize)((function(e){return function(){return g((function(t){return Object(O.a)(Object(O.a)({},t),{},Object(d.a)({},e,!t[e]))}))}})),[]),N=se(),y=Object(c.useCallback)((function(){return N(H(f))}),[N,f]);a.a.useEffect((function(){if(o){var e;return function t(){y(),e=setTimeout((function(){t()}),k)}(),function(){return clearTimeout(e)}}D([t]).then((function(e){var t=Object(ye.a)(e,1)[0];return s(t)})).catch((function(e){m(e.message),console.error("Log somewhere error",e)}))}),[y,o,t]);var S=ue(G),w=a.a.useMemo((function(){return S.filter((function(e){return e.parent===Number(t)}))}),[t,S]),C=ue((function(e){return K(e,f)})),P=ue(Y);return o?Object(je.jsxs)(Le,{children:[Object(je.jsx)("h1",{className:"mt-4 mb-4",children:o.title}),Object(je.jsxs)("dl",{className:"row",children:[Object(je.jsx)("dt",{className:"col-sm-1",children:"Author"}),Object(je.jsx)("dd",{className:"col-sm-11",children:o.by}),Object(je.jsx)("dt",{className:"col-sm-1",children:"Date"}),Object(je.jsx)("dd",{className:"col-sm-11",children:R(o.time)}),o.url&&Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)("dt",{className:"col-sm-1",children:"link"}),Object(je.jsx)("dd",{className:"col-sm-11",children:Object(je.jsx)("a",{href:o.url,children:o.url})})]}),o.text&&Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)("dt",{className:"col-sm-1",children:"Text"}),Object(je.jsx)("dd",{className:"col-sm-11",dangerouslySetInnerHTML:{__html:Ce()(o.text)}})]})]}),Object(Se.isEmpty)(w)?null:Object(je.jsxs)(je.Fragment,{children:[Object(je.jsxs)("div",{className:"d-flex align-items-center mt-5 mb-4",children:[Object(je.jsxs)("h2",{children:["Comments (",C,")"]}),Object(je.jsx)(ge,{onClick:y,disabled:P,tooltipText:"Refresh comments"})]}),w.map((function(e){return Object(je.jsx)(Re,{comment:e,onClick:_(e.id),rootCommentsState:p,comments:S},e.id)}))]})]}):Object(je.jsx)(Le,{children:Object(je.jsx)("div",{className:Ee.a["story--loading"],children:b?Object(je.jsxs)(ke.a,{variant:"danger",children:["Something goes wrong: \xa0".concat(b),Object(je.jsx)("br",{}),Object(je.jsx)("br",{}),"Try to refresh the page."]}):Object(je.jsx)(te.a,{animation:"border",variant:"primary"})})})};o.a.render(Object(je.jsx)(a.a.StrictMode,{children:Object(je.jsx)(s.a,{store:Z,children:Object(je.jsx)(u.a,{children:Object(je.jsxs)(l.c,{children:[Object(je.jsx)(l.a,{exact:!0,component:Ne,path:E("/")}),Object(je.jsx)(l.a,{component:De,path:E("/:id")})]})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},73:function(e,t,n){e.exports={"comments--loading":"Story_comments--loading__1vnw4","story--loading":"Story_story--loading__v6jwJ"}},87:function(e,t){},88:function(e,t){},96:function(e,t,n){e.exports={content:"Home_content__2Q55q","content--loading":"Home_content--loading__1nnvB"}},99:function(e,t,n){e.exports={button:"NavbarComponent_button__1NXhp",icon:"NavbarComponent_icon__2QjTR"}}},[[190,1,2]]]);
//# sourceMappingURL=main.1f439f0d.chunk.js.map